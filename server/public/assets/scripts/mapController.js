angular.module("northApp").controller("MapController",["$scope","leafletData","leafletMarkerEvents",function(a,b,c){var d=this;d.lastClicked={},d.storedMarkers={m1:{lat:44.996121,lng:-93.295845,title:"Mr. Books Bruschetta Machine",type:"one",visible:!1},m2:{lat:44.998995,lng:-93.291068,title:"Ms. Kitchens Oblique Reference Parlor",type:"two",visible:!1},m3:{lat:44.999143,lng:-93.297133,title:"Mr. Bones Bruschetta Machine",type:"one",visible:!1},m4:{lat:45.002572,lng:-93.289515,title:"Ms. Burbakers Oblique Reference Parlor",type:"two",visible:!1}},d.markerSize=Object.keys(d.storedMarkers).length,d.count=d.markerSize+1,d.visibleMarkers={},d.filterMarkers=function(a){if(d.visibleMarkers={},"all"===a)for(marker in d.storedMarkers)d.storedMarkers[marker].visibility=!0;else if("none"===a)for(marker in d.storedMarkers)d.storedMarkers[marker].visibility=!1;else for(marker in d.storedMarkers)d.storedMarkers[marker].type===a&&(d.storedMarkers[marker].visibility=!d.storedMarkers[marker].visibility);for(marker in d.storedMarkers)d.storedMarkers[marker].visibility&&(d.visibleMarkers["m"+d.count]=d.storedMarkers[marker],d.count++);angular.extend(d,{markers:d.visibleMarkers}),console.log("visiibleMarkers:",d.visibleMarkers)},angular.extend(d,{defaults:{scrollWheelZoom:!1,touchZoom:!0,dragging:!0,tap:!0,tapTolerance:100},center:{lat:44.996121,lng:-93.295845,zoom:15},tiles:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"},markers:d.visibleMarkers}),a.$on("leafletDirectiveMarker.map.click",function(a,c){d.showInfoDrawer=!0,d.lastClicked=c.model,d.markerTitle=d.lastClicked.title,d.mapStyle={height:"20vh"},b.getMap().then(function(a){setTimeout(function(){a.invalidateSize(),console.log("called")},200)}),angular.extend(d,{center:{lat:d.lastClicked.lat,lng:d.lastClicked.lng,zoom:15}})}),a.$on("leafletDirectiveMap.map.click",function(a,c){d.showInfoDrawer=!1,d.mapStyle={height:"100vh"},b.getMap().then(function(a){setTimeout(function(){a.invalidateSize(),console.log("called")},100)}),angular.extend(d,{center:{lat:d.lastClicked.lat,lng:d.lastClicked.lng,zoom:15}})}),a.$on("leafletDirectiveMap.map.resize",function(a,b){console.log("resized map")}),d.filterMarkers("all"),console.log("Map controller loaded.")}]);