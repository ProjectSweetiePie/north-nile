/*! north-nile 2016-05-22 */
var app=angular.module("northApp",["ngRoute","leaflet-directive","ngMaterial","ngMessages","ngAnimate"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"hc"}).when("/map",{templateUrl:"/views/map.html",controller:"MapController",controllerAs:"mc"}),b.html5Mode(!0)}]),app.controller("MapController",["$scope","leafletData",function(a,b){var c=this;c.lastClicked={},c.storedMarkers={m1:{lat:44.996121,lng:-93.295845,title:"Mr. Books Bruschetta Machine",type:"one",visible:!1},m2:{lat:44.998995,lng:-93.291068,title:"Ms. Kitchens Oblique Reference Parlor",type:"two",visible:!1},m3:{lat:44.999143,lng:-93.297133,title:"Mr. Bones Bruschetta Machine",type:"one",visible:!1},m4:{lat:45.002572,lng:-93.289515,title:"Ms. Burbakers Oblique Reference Parlor",type:"two",visible:!1}},c.markerSize=Object.keys(c.storedMarkers).length,c.count=c.markerSize+1,c.visibleMarkers={},c.filterMarkers=function(a){if(c.visibleMarkers={},"all"===a)for(marker in c.storedMarkers)c.storedMarkers[marker].visibility=!0;else if("none"===a)for(marker in c.storedMarkers)c.storedMarkers[marker].visibility=!1;else for(marker in c.storedMarkers)c.storedMarkers[marker].type===a&&(c.storedMarkers[marker].visibility=!c.storedMarkers[marker].visibility);for(marker in c.storedMarkers)c.storedMarkers[marker].visibility&&(c.visibleMarkers["m"+c.count]=c.storedMarkers[marker],c.count++);angular.extend(c,{markers:c.visibleMarkers}),console.log("visiibleMarkers:",c.visibleMarkers)},angular.extend(c,{defaults:{scrollWheelZoom:!1,touchZoom:!0,dragging:!0},center:{lat:44.996121,lng:-93.295845,zoom:15},tiles:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"},markers:c.visibleMarkers}),a.$on("leafletDirectiveMarker.map.click",function(a,d){console.log("visibleMarkers on click:",c.visibleMarkers),c.showInfoDrawer=!0,c.lastClicked=d.model,c.markerTitle=c.lastClicked.title,c.mapStyle={height:"20vh"},b.getMap().then(function(a){setTimeout(function(){a.invalidateSize(),console.log("called")},200)}),angular.extend(c,{center:{lat:c.lastClicked.lat,lng:c.lastClicked.lng,zoom:15}})}),a.$on("leafletDirectiveMap.map.click",function(a,d){c.showInfoDrawer=!1,c.mapStyle={height:"100vh"},b.getMap().then(function(a){setTimeout(function(){a.invalidateSize(),console.log("called")},100)}),angular.extend(c,{center:{lat:c.lastClicked.lat,lng:c.lastClicked.lng,zoom:15}})}),a.$on("leafletDirectiveMap.map.resize",function(a,b){console.log("resized map")}),c.filterMarkers("all"),console.log("Map controller loaded.")}]),app.controller("HomeController",["$http","$mdDialog",function(a,b){var c,d=this;d.loginInfo={},d.registerInfo={},d.loginShow=function(){d.loginForm=!0,d.registerForm=!1},d.registerShow=function(){console.log("hit registerShow"),d.registerForm=!0,d.loginForm=!1},d.loginUser=function(){a.post("/login",d.loginInfo).then(function(a){200==a.status&&(console.log("successful login",a.data.isAdmin),1==a.data.isAdmin?(console.log("admin is true"),d.loginInfo={},d.adminDashboard=!0,d.userDashboard=!1,d.registerForm=!1,d.loginForm=!1):(console.log("admin is not true"),d.loginInfo={},d.userDashboard=!0,d.adminDashboard=!1,d.registerForm=!1,d.loginForm=!1))},function(a){function e(){c=b.alert({title:"Attention",textContent:"Incorrect username and/or password. Please enter information again.",ok:"Close"}),b.show(c)["finally"](function(){c=void 0})}console.log("unsuccessful login"),e(),d.loginInfo={}})},d.registerUser=function(){a.post("/register",d.registerInfo).then(function(a){function e(){c=b.alert({title:"Congratulations!",textContent:"Registration successful, please log in.",ok:"Close"}),b.show(c)["finally"](function(){c=void 0})}200==a.status&&(console.log("successful registration"),e(),d.registerInfo={},d.registerForm=!1,d.loginForm=!0)},function(a){function e(){c=b.alert({title:"Attention",textContent:"Username already exists, please choose another.",ok:"Close"}),b.show(c)["finally"](function(){c=void 0})}console.log("unsuccessful registration"),e(),d.registerInfo.username=void 0})},console.log("Home controller loaded.")}]);
